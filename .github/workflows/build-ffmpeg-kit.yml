name: Build FFmpeg-Kit FireTV (arm64)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install required packages
        run: |
          sudo apt update
          sudo apt install -y git build-essential autoconf automake libtool pkg-config yasm nasm unzip wget

      - name: Clone ffmpeg-kit
        run: |
          git clone https://github.com/arthenica/ffmpeg-kit.git
          cd ffmpeg-kit
          git checkout main

      - name: Download Android NDK r26d
        run: |
          wget https://dl.google.com/android/repository/android-ndk-r26d-linux.zip
          unzip android-ndk-r26d-linux.zip -d $GITHUB_WORKSPACE
          mv $GITHUB_WORKSPACE/android-ndk-r26d $GITHUB_WORKSPACE/ndk

      - name: Export Android paths
        run: |
          echo "ANDROID_NDK_ROOT=$GITHUB_WORKSPACE/ndk" >> $GITHUB_ENV
          echo "ANDROID_SDK_ROOT=$GITHUB_WORKSPACE/android-sdk" >> $GITHUB_ENV
          mkdir -p $GITHUB_WORKSPACE/android-sdk

      - name: Build FFmpeg-Kit for arm64 (Fire TV Stick)
        run: |
          cd ffmpeg-kit
          chmod +x android.sh
          ./android.sh --api-level=21 --disable-armv7 --disable-armv7neon --disable-x86 --disable-x86_64

      - name: Upload AAR Artifact
        uses: actions/upload-artifact@v4
        with:
          name: ffmpeg-kit-firetv-aar
          path: ffmpeg-kit/prebuilt/**/ffmpeg-kit/ffmpeg-kit.aar
